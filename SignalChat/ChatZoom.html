<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="Content/themes/base/bootstarp.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="row form-group">
                <form>
                    <div class="form-group">
                        <label for="exampleInputName">Content</label>
                        <input type="text" class="form-control" id="exampleInputContent" placeholder="Content">
                    </div>
                    <button type="button" id="Send" class="btn btn-default">Send</button>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-7" style="border:1px solid green; min-height:500px;" id="Content">

            </div>
            <div class="col-lg-5" style="border:1px solid red; min-height:500px;">
                用户列表( <span id="u_Count"></span> )
                <ul id="UserInfo">
                 
                </ul>
            </div>
        </div>
    </div>

    <script src="Scripts/jquery-3.4.1.min.js"></script>
    <script src="Scripts/bootstarp.min.js"></script>
    <script src="Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="signalr/hubs"></script>
    <script type="text/javascript">
        $(function () {
            var zoomID = getUrlParam("zoomID");
            var uname = decodeURI(getUrlParam("uname"));

            var zoom = $.connection.zoomChatHub;
            zoom.client.updateZoom = function (ZoomDic, UserDic) {
                top.ZoomDic = ZoomDic;
                top.UserDic = UserDic;
                var CurrentUsers = top.UserDic.filter(x => x.ZoomKey == zoomID);
                $("title").html("Welcome to " + top.ZoomDic.filter(item => { return item.Key == zoomID })[0].Value);
                $("#u_Count").html(CurrentUsers.length);
                $("#UserInfo").html("");
                CurrentUsers.forEach(item => {
                    $(`<li ${item.NickName == uname ? "style='Color:Green;'" : ""} >${item.NickName}</li>`).appendTo($("#UserInfo"));
                });
            };
            zoom.client.sendMessage = function (zoomID, msg) {
                console.log(msg);
                $(`<div class="row">${msg}</div>`).appendTo($("#Content"));
            }

            $.connection.hub.start().done(function () {
                zoom.server.login(uname);
            });

            $("#Send").click(function () {
                var msg = $("#exampleInputContent").val();
                zoom.server.sendMsg(uname, zoomID, msg);
            });
        });

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
    </script>
</body>
</html>